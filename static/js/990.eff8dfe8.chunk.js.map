{"version":3,"file":"static/js/990.eff8dfe8.chunk.js","mappings":"kMAOA,MAkFA,EAlFgBA,KACd,MAAMC,GAAWC,EAAAA,EAAAA,MACXC,GAAWC,EAAAA,EAAAA,MACXC,EAAY,IAAIC,gBAAgBL,EAASM,QAAQC,IAAI,eACpDC,EAAcC,IAAmBC,EAAAA,EAAAA,UAAS,OAEjDC,EAAAA,EAAAA,YAAU,KA+BJP,GA9BqBQ,WACvB,IAEE,MAAQC,KAAMC,SAAkBC,EAAAA,EAAMR,IAAI,kDAADS,OAAmDZ,IAI5F,GAAIU,GAAWA,EAAQG,UAAYH,EAAQG,SAAST,aAAc,CAChE,MAAMA,EAAeU,KAAKC,MAAML,EAAQG,SAAST,cAG3CY,QAAiBL,EAAAA,EAAMM,KAAK,yCAA0C,CAC1Eb,eACAc,WAAYR,EAAQS,eACpBC,eAAgBV,EAAQW,aAAe,MAGjB,MAApBL,EAASM,SACXC,EAAAA,GAAMC,QAAQ,sCAEdC,EAAoBT,EAASP,KAAKiB,aAEtC,MACEH,EAAAA,GAAMI,MAAM,qCAEhB,CAAE,MAAOA,GACPC,QAAQD,MAAM,6BAA8BA,EAC9C,GAIAE,EACF,GACC,CAAC7B,IAGJ,MAAMyB,EAAsBjB,UAC1B,IACE,MAAMQ,QAAiBL,EAAAA,EAAMR,IAAI,0CAADS,OAA2Cc,IAC3EE,QAAQE,IAAI,4CAA6CJ,GACzDrB,EAAgBW,EAASP,KAC3B,CAAE,MAAOsB,GACPH,QAAQE,IAAIC,EACd,GAWF,OAEEC,EAAAA,EAAAA,KAAA,WAASC,UAAU,6BAA4BC,UAC7CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,eAAcC,SAAA,EAC7BF,EAAAA,EAAAA,KAAA,MAAAE,SAAI,sCAEH9B,GACC+B,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACEC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,aAAYC,SAAA,CAAC,MAAI9B,EAAagC,KAAK,uCAChDD,EAAAA,EAAAA,MAAA,KAAAD,SAAA,CAAG,qBAAmB9B,EAAasB,mBAGrCM,EAAAA,EAAAA,KAAA,KAAAE,SAAG,iCAEPF,EAAAA,EAAAA,KAAA,UAAQK,KAAK,SAASJ,UAAU,4BAA4BK,QArBzCC,KAEnBC,eAAeC,WAAW,SAC1B3C,EAAS,QAAQ,EAkBiEoC,SAAC,gBAGzE,C","sources":["Components/Pages/Success.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { toast } from 'react-toastify';\r\nimport './Css/SuccessPage.css';\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst Success = () => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();  \r\n  const sessionId = new URLSearchParams(location.search).get('session_id');\r\n  const [adoptionData, setAdoptionData] = useState(null); // Store specific adoption data\r\n\r\n  useEffect(() => {\r\n    const saveAdoptionData = async () => {\r\n      try {\r\n        // Fetch the session details from Stripe\r\n        const { data: session } = await axios.get(`http://localhost:8081/api/adoption/get-session/${sessionId}`);\r\n\r\n        \r\n        // Ensure that adoptionData exists in session.metadata\r\n        if (session && session.metadata && session.metadata.adoptionData) {\r\n          const adoptionData = JSON.parse(session.metadata.adoptionData);\r\n\r\n          // Save the adoption form data with the payment ID\r\n          const response = await axios.post('http://localhost:8081/api/adoption/add', {\r\n            adoptionData,\r\n            payment_id: session.payment_intent,\r\n            payment_amount: session.amount_total / 100, // Convert back to PKR\r\n          });\r\n\r\n          if (response.status === 200) {\r\n            toast.success('Adoption request sent successfully');\r\n            // Fetch the specific adoption record for the user\r\n            fetchAdoptionRecord(response.data.orderNumber); \r\n          }\r\n        } else {\r\n          toast.error('Unable to send adoption request...');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error saving adoption data', error);\r\n      }\r\n    };\r\n\r\n    if (sessionId) {\r\n      saveAdoptionData();\r\n    }\r\n  }, [sessionId]);\r\n\r\n  // Fetch specific adoption record based on order number\r\n  const fetchAdoptionRecord = async (orderNumber) => {\r\n    try {\r\n      const response = await axios.get(`http://localhost:8081/api/adoption/get/${orderNumber}`); \r\n      console.log('Adoption data fetch successful for order:', orderNumber);\r\n      setAdoptionData(response.data); \r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  // Handle Go Back button click and remove sessionId\r\n  const handleGoBack = () => {\r\n    // Clear the session_id from the URL\r\n    sessionStorage.removeItem('token');\r\n    navigate('/pets');  \r\n\r\n  };\r\n\r\n  return (\r\n\r\n    <section className=\"sec-container success-page\">\r\n      <div className=\"success-data\">\r\n      <h2>Thank You For making Pet Adoption</h2>\r\n\r\n      {adoptionData ? ( // Check if specific adoption data exists\r\n        <div>\r\n          <p className=\"thank-mesg\">Hi {adoptionData.user}, Your payment sent successfully</p>\r\n          <p>Your order no. is {adoptionData.orderNumber}</p>\r\n        </div>\r\n      ) : (\r\n        <p>No adoption data available.</p>\r\n      )}\r\n    <button type=\"button\" className=\"btn btn-info m-3 btn-back\" onClick={handleGoBack}>Go Back</button>\r\n    </div>\r\n        \r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Success;\r\n"],"names":["Success","location","useLocation","navigate","useNavigate","sessionId","URLSearchParams","search","get","adoptionData","setAdoptionData","useState","useEffect","async","data","session","axios","concat","metadata","JSON","parse","response","post","payment_id","payment_intent","payment_amount","amount_total","status","toast","success","fetchAdoptionRecord","orderNumber","error","console","saveAdoptionData","log","err","_jsx","className","children","_jsxs","user","type","onClick","handleGoBack","sessionStorage","removeItem"],"sourceRoot":""}